---
title: "Visual Analysis of Olympics Performance"
author: "Elated Anura"
output: 
  github_document:
    toc: true
    toc_depth: 2
---

# Visual Analysis of Olympics Performance

```{r load-packages, message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse) # data manipulation
library(psych) # describe function: statistical summary
library(broom) # tidy function: statistical outputs into tibbles
library(kableExtra) # make-up tables
library(stargazer) # nice regression outputs
library(here) # simplifies relative file paths
library(countrycode) #get country names
library(emojifont) # add emoji font
library(cowplot)
```

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

```{r load-data, message=FALSE, warning=FALSE,}
#read in datasets
olympics_data <- read_csv(here("data", "olympics.csv"))
countrycode <- codelist_panel %>%
  rename(noc = ioc,
         country = country.name.en) %>%
  select(noc, continent, country) %>%
  distinct()

#amend datasets to include new variables and fill crucial missing values
countrycode$noc[70] <- "GDR"
countrycode$continent[70] <- "Europe"
countrycode$noc[51] <- "TCH"
countrycode$continent[51] <- "Europe"
countrycode[nrow(countrycode) + 1,] <- "URS"
countrycode[nrow(countrycode) +1,] <- "FRG"
#countrycode[nrow(countrycode) + 1,] <- c("URS", "Europe", "Soviet Union", "Warsaw Pact")

#merge olympics and countrycode datasets
olympics_joined <- left_join(olympics_data, unique(countrycode), by = "noc")

#add/manipulate variables to merged dataset
olympics_joined <- olympics_joined %>%
  mutate(medal_binary = ifelse(!is.na(medal), 1, 0),
         medal_weighted = case_when(medal == "Gold" ~ 3,
                                    medal == "Silver" ~ 2,
                                    medal == "Bronze" ~ 1,
                                    TRUE ~ 0),
         nato_wp = case_when(country == "Belgium" | country == "Canada" | country == "Denmark" | country == "France" | country == "Iceland" | country == "Italy" | country == "Luxembourg" | country == "Netherlands" | country == "Norway" | country == "Portugal" | country == "United Kingdom" | country == "United States" | country == "Greece" | country == "Turkey" | country == "West Germany" | country == "Germany" | country == "Spain" ~ "NATO",
                             country == "Russia" | country == "Hungary" | country == "Bulgaria" | country == "Poland" | country == "German Democratic Republic" | country == "Romania" | country == "Czechoslovakia" | country == "URS"~ "Warsaw Pact", #CHANGE THIS to Soviet Union when figured out
                             TRUE ~ "Non-Aligned or not applicable"),
         usa_ussr = case_when(noc == "URS" | noc == "RUS" ~ "USSR/Russia",
                              noc == "USA" ~ "USA",
                              TRUE ~ "Other")) %>%
  group_by(games) %>%
  mutate(medal_sum = sum(medal_binary))

#set theme for graphs
bg_theme <- theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = rel(1.2)),
        axis.title.x = element_text(margin = margin(t = 10), size = rel(0.8)),
        axis.title.y = element_text(margin = margin(r = 10),size = rel(0.8)),
        strip.text = element_text(face = "bold", size = rel(0.8), hjust = 0.5),
        plot.caption = element_text(face = "italic",size = rel(0.8), 
                                    margin = margin(t = 10)),
        legend.title = element_text(face = "bold",size = rel(0.6)),
        legend.text = element_text(size = rel(0.6)))
```

## Question 1

### Introduction

The Olympics served as an outlet for different (city-)states to compete with one another through athletics rather than warfare both in antiquity and modernity. Given that following World War II, there was a bipolar world order with the United States of America (USA) and the Union of Soviet Socialist Republics (USSR) as the world’s greatest superpowers, the Olympics were an outlet for the two players to compete with one another outside of the many proxy wars they fought. In the following, we want to examine the following questions: 

1. How has the dominance of the Soviet Union (/Russia as its main successor) and the United States changed throughout the cold war and after?
2. How do NATO and Warsaw Pact member-states compare in terms of medals won at the Olympics?

In order to answer these questions, we examine the `country` variable (coded based on the `noc` variable) and, relatedly, the `nato_wp` variable which indicates whether a country was a member of NATO, the Warsaw Pact, or non-aligned (also coded based on the `noc` variable). To measure their success in the Olympics, we calculate the proportion of medals won by the USSR/Russia or the USA and all other countries (stored in the `medal_prop` variable), and examine the total amount of medals won by NATO/Warsaw Pact members. Finally, we also assess the `season` variable in order to differentiate between Summer and Winter Olympics.

Please note that we categorize countries into the NATO or Warsaw Pact categories based on their allegiances during the Cold War. Countries like Poland or the Baltic countries which were part of the Warsaw Pact during the Cold War and joined NATO after it ended are still coded as Warsaw Pact members. Moreover, we decided not to include Albania as a Warsaw Pact member due to the Soviet-Albanian split of 1968.

### Approach

We believe that time-series plots are best-suited to examine changes and trends over periods of time; thus we construct a time-series plot and line graph to examine how the proportion of medals won by the USA and USSR/Russia have developed over time. On the x-axis, we plot the `year` variable, and on the y-axis, we plot the `medal_prop` variable indicating the proportion of medals won by the United States and the USSR/Russia. The color aesthetic helps us differentiate between medals won by the United States, the USSR/Russia, and other countries. We facet the plot by the `season` variable to indicate whether medals were won in Summer or Winter Olympics, and add vertical lines to this plot indicating the end of World War II (1945), as well as the end of the cold war as marked by the dissolution of the USSR (1991).

As the second question is more about the overall performance of members of the Warsaw PAct and NATO, we choose to represent the type and amount of medals won by each relevant country in a stacked bar chart. The bars itself indicate the amount of medals each country won, and the bars are ordered based on the total amount of medals won in descending order. Further, we use colors to indicate whether a country was aligned with NATO or the Warsaw Pact, and different-colored emojis indicate the amount of gold, silver, and bronze medals each country won. We believe that this is the best way of assessing the question visually, as it represents all relevant information in a simple, straightforward manner.

### Analysis

Analysis (2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with ggplot2. Do not use base R or lattice plotting functions.

```{r q1-analysis-plot-1}
#create data frame with information relevant to create visualization
q1_df <- olympics_joined %>%
  filter(year >= 1922) %>%
  group_by(year, usa_ussr, season) %>%
  summarize(medal_prop = (sum(medal_binary)/medal_sum))

#create plot mapping USA/USSR/others medals over time
q1_df %>%
  ggplot(mapping = aes(x = year, y = medal_prop, color = usa_ussr, na.rm = TRUE))+
  geom_line() +
  geom_vline(xintercept = 1945,
             linetype = "dashed",
             alpha = 0.75) +
  geom_vline(xintercept = 1991,
             linetype = "dashed",
             alpha = 0.75) +
  geom_text(mapping = aes(x = 1945, y = 0.9, label= "End of World War II")) +
  geom_text(mapping = aes(x = 1991, y = 0.9, label= "Dissolution of the USSR")) +
  facet_wrap(vars(season)) +
  scale_color_manual(values = c("grey", "blue", "red")) +
  scale_x_continuous(breaks = seq(1920, 2022, 12),
                     name = "Year") +
  scale_y_continuous(breaks = seq(0, 1, 0.2),
                     name = "Proportion of Medals Won") +
  bg_theme +
  theme(axis.text.x = element_text(angle = 30, hjust = 1),
        panel.spacing = unit(1.5, "lines")) +
  labs(title = "Olympic Performance of USSR/Russia and USA over Time",
       subtitle = "Proportion of Medals Won by Each Country in Summer and Winter Olympics",
       caption = "Source: data from www.sports-reference.com in 2018",
       color = "Country")
```

```{r q1-analysis-plot-2}
#create data frame with information relevant to create visualization
q2_df <- olympics_joined %>%
  filter((nato_wp == "NATO" | nato_wp == "Warsaw Pact") & (year >= 1945 & year <= 1991)) %>%
  group_by(country, nato_wp, year) %>%
  summarize(medals_won = sum(medal_binary))

#create stacked bar chart mapping amount of medals won by country
q2_df %>%
  ggplot(mapping = aes(y = reorder(country, medals_won), x = medals_won)) +
  geom_col() +
  bg_theme
```

### Discussion

Discussion (1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.


We encourage you to be concise. A paragraph should typically not be longer than 5 sentences. You are not required to perform any statistical tests in this project, but you may do so if you find it helpful to answer your question.

## Question 2

### Introduction

Women started to participate in the Olympic Games from the year of 1900 in Paris. Among a total of around 1,000 athletes, only 22 women competed in five sports, according to International Olympic Committee. Since then, the number of female participants and that of sports females can compete has increased and is expected to keep increasing in the near future. Given persisting gender inequalities in many countries, we are interested in analyzing gender representation in the sports’ world. From a historical perspective, first, we are curious about how female participation has changed in Olympic Games. Second, we also look into the female athletes performance on the country level and plan to spotlight countries with top female contribution. Our following approach, analysis, and visualization will further demonstrate these two issues of interest.

To illustrate gender difference in Olympic, our dataset provides rich information on individual athletes with their `name`, `sex`, `noc`, `sports`, `year`, `medal`, etc. It allows us to create new variables for summarized tables and time-series analysis. For example, it is feasible to compute the proportion of female athletes and the count of sports for each Game and season over the years. Grouping by the `noc` code, the dataset aids us in creating a new geographical categorical variable `continent`, and generating summarized tables for ranking and comparing females medalists across countries. More rigorously, since countries may differ greatly in the number of female participants, we can normalize the measure of female medalists by calculating the proportion of medals that comes from female athletes for a given country. 

### Approach

Approach (1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

To answer the first question, “How does female participation in Olympics Games change? ” we construct an overall time-series line plot. This plot comes from a summarized table with the average proportion of female to male athletes and the proportion of games female athletes participate in over the years. The two measures are positioned on the y-axis and illustrated in different colors - and they are manually set to be Olympic logos and symbols colors! The year for each event is on the x-axis. The season information is demonstrated through two different facets. We choose the line plot format first because it can best visually represent the trend information. Second, it has an advantage in terms of data-ink-ratio for visualization, therefore it to some extent simplifies the complexities in our aggregated data.

For the second part, “Which countries have the highest numbers of female medalists or enjoy the most contributions from female athletes over the recent years?” we construct a stacked bar plot with two facets, both of them rank the top 15 countries with the highest measurements. The y-axis shows the names of countries with the top rankings. The x-axis on one facet illustrates the number of female medalists, and on the other one, it contains the proportion of medals from female athletes relative to the country’s total number of medals. The types of medals are shown in different colors. The stacked bar plot is comparatively the best format to approach this question because it can clearly show the medal distribution and order the countries following their rankings. It can give viewers a sense of quantity through visualization.

### Analysis

Analysis (2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with ggplot2. Do not use base R or lattice plotting functions.

```{r Q2-1-female participation, message=FALSE, warning=FALSE}
# Create a summarized table for participation by gender for each season
participate_sex <- olympics_joined %>% 
  group_by(year, season, sex) %>%
  summarize(count_sex = n_distinct(id), 
            count_game = n_distinct(sport), .groups = "drop")%>% 
  group_by(year, season) %>%
  mutate(visit = 1:n()) %>%
  gather("sex", "count_sex", "count_game", key = variable, value = number) %>%
  unite(combi, variable, visit) %>%
  spread(combi, number) %>%
  select(-c("sex_1", "sex_2")) %>% 
  mutate(count_sex_1 = as.numeric(count_sex_1),
         count_sex_2 = as.numeric(count_sex_2),
         count_game_1 = as.numeric(count_game_1),
         count_game_2 = as.numeric(count_game_2)) %>%
  mutate(f_athletes_p = count_sex_1 / sum(count_sex_1, count_sex_2),
         f_games_p = count_game_1 / sum(count_game_1, count_game_2))
q2_p1 <- participate_sex %>% 
  ggplot(aes(x = year, y = f_athletes_p)) +
  geom_line(aes(color = "Number of female athletes")) +
  geom_line(aes(x = year, y = f_games_p, 
                color = "Games females compete in")) + 
  facet_wrap(vars(season), scales = "free") +
  labs(title = "Female athletes participation in Olympic Games by season",
       subtitle = "From year 1900 to 2016",
       x = "Year",
       y = "Proportion",
       caption = "Source: data from www.sports-reference.com in 2018") +
  scale_color_manual(name = "Proportion of",
                     breaks = c("Number of female athletes",  "Games females compete in"),
                     values=c("Number of female athletes" = "orange",
                              "Games females compete in" = "steelblue")) +
  scale_color_manual(name = "Proportion of",
                    breaks = c("Games females compete in", "Number of female athletes"),
                    values=c("Number of female athletes" = "#F4C300",
                             "Games females compete in" = "#0085C7"))
q2_p1 + bg_theme
```

```{r Q2-2-country ranking, dev='ragg_png'}
medalist_rank <- olympics_joined %>%
  filter(year >= 2000) %>% # focusing on  recent years
  mutate(gold = if_else(medal == "Gold", 1, 0),
         silver = if_else(medal == "Silver", 1, 0),
         bronze = if_else(medal == "Bronze", 1, 0)) %>%
  group_by(country, sex) %>%
  summarize(n_gold = sum(gold, na.rm = TRUE), 
            n_silver = sum(silver, na.rm = TRUE), 
            n_bronze = sum(bronze, na.rm = TRUE), .groups = "drop") %>%
  mutate(n_medal = n_gold + n_silver + n_bronze) %>%
  group_by(country) %>%
  mutate(visit = 1:n()) %>%
  gather("sex", "n_gold", "n_silver", "n_bronze", "n_medal", 
         key = variable, value = number) %>%
  unite(combi, variable, visit) %>%
  spread(combi, number) %>%
  select(-c("sex_1", "sex_2"))
medalist_rank[2:9] = lapply(medalist_rank[2:9], FUN = function(y){as.numeric(y)})
medalist_rank <- medalist_rank %>%
  mutate(fp_medal = n_medal_1 / sum(n_medal_1, n_medal_2))
top_15 <- medalist_rank %>%
  arrange(desc(n_medal_1)) %>%
  head(15) %>%
  mutate(n_b_s = n_bronze_1 + n_silver_1)
q2_p2_1 <- top_15 %>%
  ggplot(aes(x = n_medal_1, y = reorder(country, n_medal_1))) +
  geom_segment(aes(yend = country), xend = 0, colour = "#F4C300", size = 0.5, alpha = 0.6) +
  geom_emoji(alias = 'trophy', x = top_15$n_medal_1, y = top_15$country, 
             size = 3.5, color = "#D6AF36") +
  geom_emoji(alias = 'trophy', x = top_15$n_bronze_1, y = top_15$country, 
             size = 3.5, color = "#824A02") +
  geom_emoji(alias = 'trophy', x = top_15$n_b_s, y = top_15$country, 
             size = 3.5, color = "#A7A7AD") +
  scale_x_continuous(breaks = seq(0, 1000, 200)) +
  annotate("text", label = "Types of medals", x = 600, y = "United Kingdom", size = rel(2.6)) +
  annotate("rect", xmin = 400, xmax = 800, ymin = "Italy", ymax = "Japan", alpha = .1) +
  annotate("point", x = 500, y = "South Korea", colour = "#D6AF36", size = 1) +
  annotate("point", x = 500, y = "Norway", colour = "#824A02", size = 1) +
  annotate("point", x = 500, y = "France", colour = "#A7A7AD", size = 1) +
  annotate("text", x = 600, y = "South Korea", label = "Gold", size = rel(2.4), colour = "#D6AF36") +
  annotate("text", x = 600, y = "Norway", label = "Silver", size = rel(2.4), colour = "#824A02") +
  annotate("text", x = 600, y = "France", label = "Bronze", size = rel(2.4), colour = "#A7A7AD") + 
  labs(x = "Number of medals", y = "Countries",
       caption = " ") +
  theme_minimal() +
  bg_theme +
  theme(panel.grid.major.y = element_blank(),
        axis.text.y = element_text(size = rel(0.8))) 
q2_p2_2 <- top_15 %>% 
  ggplot(aes(x = fp_medal, y = reorder(country, n_medal_1))) +
  geom_segment(aes(yend = country), xend = 0, colour = "#009F3D", size = 0.5, alpha = 0.6) +
  geom_emoji(alias = 'trophy', 
             x = c(top_15$fp_medal[15], top_15$fp_medal[3], top_15$fp_medal[7]), 
             y = c("Romania", "China", "Netherlands"),
             size = 4, color = "#000000") +
  labs(x = "Proportion of medals won by women", 
       caption = "Source: data from www.sports-reference.com in 2018") + 
  bg_theme +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        panel.grid.major.y = element_blank()) 
q2_p2 <- plot_grid(q2_p2_1, q2_p2_2, rel_widths = c(4.5, 3),
                   labels = c("No Nomalization ", "Nomalization"),
                   ncol = 2, nrow = 1, label_size = 8)
title <- ggdraw() + 
  draw_label("Top 15 countries in female contribution in Olympic Games",
             fontface = 'bold', x = 0, hjust = -0.2) +
  theme(plot.margin = margin(0, 0, 0, 10))
plot_grid(title, q2_p2, ncol = 1, rel_heights = c(0.1, 1))
```

### Discussion

Discussion (1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.


We encourage you to be concise. A paragraph should typically not be longer than 5 sentences. You are not required to perform any statistical tests in this project, but you may do so if you find it helpful to answer your question.





