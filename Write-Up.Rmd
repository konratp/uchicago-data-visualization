---
title: "Visual Analysis of Olympics Performance"
author: "Elated Anura"
output: 
  github_document:
    toc: true
    toc_depth: 2
---

# Visual Analysis of Olympics Performance

```{r load-packages, message=FALSE, warning=FALSE}
library(tidyverse) # data manipulation
library(psych) # describe function: statistical summary
library(broom) # tidy function: statistical outputs into tibbles
library(kableExtra) # make-up tables
library(stargazer) # nice regression outputs
library(here) # simplifies relative file paths
library(countrycode) #get country names
```

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

```{r load-data}
#questions for office hours:
  #can you fill missing values with tidy approach?

#read in datasets
olympics_data <- read_csv(here("data", "olympics.csv"))
countrycode <- codelist_panel %>%
  rename(noc = ioc,
         country = country.name.en) %>%
  select(noc, continent, country) %>%
  distinct()

#amend datasets to include new variables and fill crucial missing values
countrycode$noc[70] <- "GDR"
countrycode$continent[70] <- "Europe"
countrycode$noc[51] <- "TCH"
countrycode$continent[51] <- "Europe"
countrycode[nrow(countrycode) + 1,] <- "URS"
#countrycode[nrow(countrycode) + 1,] <- c("URS", "Europe", "Soviet Union", "Warsaw Pact")

#add/manipulate variables
countrycode <- countrycode %>%
  mutate(nato_wp = case_when(country == "Belgium" | country == "Canada" | country == "Denmark" | country == "France" | country == "Iceland" | country == "Italy" | country == "Luxembourg" | country == "Netherlands" | country == "Norway" | country == "Portugal" | country == "United Kingdom" | country == "United States" | country == "Greece" | country == "Turkey" | country == "Germany" | country == "Spain" ~ "NATO",
                             country == "Russia" | country == "Hungary" | country == "Bulgaria" | country == "Poland" | country == "German Democratic Republic" | country == "Romania" | country == "Czechoslovakia" | country == "URS"~ "Warsaw Pact", #CHANGE THIS to Soviet Union when figured out
                             TRUE ~ "Non-Aligned or not applicable"),
         usa_ussr = case_when(noc == "URS" ~ "USSR",
                              noc == "USA" ~ "USA",
                              TRUE ~ "Other"))

unique(countrycode$usa_ussr)

#merge olympics and countrycode datasets
olympics_joined <- left_join(olympics_data, unique(countrycode), by = "noc")

#add/manipulate variables to merged dataset
olympics_joined_test <- olympics_joined %>%
  mutate(medal_binary = ifelse(!is.na(medal), 1, 0),
         medal_weighted = case_when(medal == "Gold" ~ 3,
                                    medal == "Silver" ~ 2,
                                    medal == "Bronze" ~ 1,
                                    TRUE ~ 0))
  
  
olympics_joined_test2 <- olympics_joined_test %>%
  group_by(games, usa_ussr) %>%
  summarize(medal_prop = (sum(medal_binary, na.rm = TRUE)))

#why does NA show up above? -- I think it has something to do with USSR/USA variable
```

## Question 1

### Introduction

The Olympics served as an outlet for different (city-)states to compete with one another through athletics rather than warfare both in antiquity and modernity. Given that following World War II, there was a bipolar world order with the United States of America (USA) and the Union of Soviet Socialist Republics (USSR) as the world’s greatest superpowers, the Olympics were an outlet for the two players to compete with one another outside of the many proxy wars they fought. In the following, we want to examine the following questions: 

1. How has the dominance of the Soviet Union (/Russia as its main successor) and the United States changed throughout the cold war and after? 
2. How do NATO and Warsaw Pact member-states compare in terms of medals won at the Olympics?

In order to answer these questions, we examine the `country` variable (coded based on the `noc` variable) and, relatedly, the `nato_wp` variable which indicates whether a country was a member of NATO, the Warsaw Pact, or non-aligned (also coded based on the `noc` variable). To measure their success in the Olympics, we calculate the proportion of medals won by the USSR/Russia or the USA and all other countries (stored in the `usa_ussr` variable), and examine the total amount of medals won by NATO/Warsaw Pact members. Finally, we also assess the `season` variable in order to differentiate between Summer and Winter Olympics. 

*add note about only treating NATO countries as such if they were in NATO during the cold war to avoid confusion with cases like Poland, Hungary, etc. -- Also add note that we exclude Albania from the Warsaw Pact due to Soviet-Albanian split in 1968*


### Approach

Approach (1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.


We believe that time-series plots are best-suited to examine changes and trends over periods of time; thus we will construct a time-series plot and line graph to examine how the proportion of medals won by the USA and USSR/Russia have developed over time. On the x-axis, we will plot the `year` variable, and on the y-axis, we will plot the `usa_ussr_medals` variable. Different colors will help us differentiate between medals won by the USA, the USSR/Russia, and other countries. We will facet the plot by the `season` variable to indicate whether medals were won in Summer or Winter Olympics, and add vertical lines to this plot indicating the founding of the Soviet Union (1922), the end of World War II (1945), as well as the end of the cold war as marked by the dissolution of the USSR (1991).

For the second question, we choose to represent the information relevant to answering the question in a stacked bar chart.

### Analysis

Analysis (2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with ggplot2. Do not use base R or lattice plotting functions.

```{r q1-analysis}
#create plot mapping USA/USSR/others medals over time
  ggplot(mapping = aes(x = year, y = medal_prop, color = usa_ussr, na.rm = TRUE))+
  geom_line()
```

### Discussion

Discussion (1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.


We encourage you to be concise. A paragraph should typically not be longer than 5 sentences. You are not required to perform any statistical tests in this project, but you may do so if you find it helpful to answer your question.

## Question 2

### Introduction

Women started to participate in the Olympic Games from the year of 1900 in Paris. Among a total of around 1,000 athletes, only 22 women competed in five sports, according to International Olympic Committee. Since then, the number of female participants and that of sports females can compete has increased and is expected to keep increasing in the near future. Given persisting gender inequalities in many countries, we are interested in analyzing gender representation in the sports’ world. From a historical perspective, first, we are curious about how female participation has changed in Olympic Games. Second, we also look into the female athletes performance on the country level and plan to spotlight countries with top female contribution. Our following approach, analysis, and visualization will further demonstrate these two issues of interest.

To illustrate gender difference in Olympic, our dataset provides rich information on individual athletes with their `name`, `sex`, `noc`, `sports`, `year`, `medal`, etc. It allows us to create new variables for summarized tables and time-series analysis. For example, it is feasible to compute the proportion of female athletes and the count of sports for each Game and season over the years. Grouping by the `noc` code, the dataset aids us in creating a new geographical categorical variable `continent`, and generating summarized tables for ranking and comparing females medalists across countries. More rigorously, since countries may differ greatly in the number of female participants, we can normalize the measure of female medalists by calculating the proportion of medals that comes from female athletes for a given country. 

### Approach

Approach (1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

To answer the first question, “How does female participation in Olympics Games change? ” we construct an overall time-series line plot. This plot comes from a summarized table with the average proportion of female to male athletes and the number of games female athletes participate in over the years. The two measures are positioned on the y-axis and illustrated in different colors. The year for each event is on the x-axis. The season information is demonstrated through two different facets. We choose the line plot format first because it can best visually represent the trend information. Second, it has an advantage in terms of data-ink-ratio for visualization, therefore it to some extent simplifies the complexities in our aggregated data.

For the second part, “Which countries have the highest numbers of female medalists or enjoy the most contributions from female athletes over the recent 50 years?” we construct a stacked bar plot with two facets, both of them rank the top 15 countries with the highest measurements. The y-axis shows the names of countries with the top rankings. The x-axis on one facet illustrates the number of female medalists, and on the other one, it contains the proportion of medals from female athletes relative to the country’s total number of medals. The types of medals are shown in different colors. The stacked bar plot is comparatively the best format to approach this question because it can clearly show the medal distribution and order the countries following their rankings. It can give viewers a sense of quantity through visualization.

### Analysis

Analysis (2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with ggplot2. Do not use base R or lattice plotting functions.

```{r Q2-1-female participation, message=FALSE, warning=FALSE}
# Create a summarized table for participation by gender for each season
participate_sex <- olympics_data %>% 
  group_by(year, season, sex) %>%
  summarize(count_sex = n_distinct(id), 
            count_game = n_distinct(sport), .groups = "drop")%>% 
  group_by(year, season) %>%
  mutate(visit = 1:n()) %>%
  gather("sex", "count_sex", "count_game", key = variable, value = number) %>%
  unite(combi, variable, visit) %>%
  spread(combi, number) %>%
  select(-c("sex_1", "sex_2")) %>% 
  mutate(count_sex_1 = as.numeric(count_sex_1),
         count_sex_2 = as.numeric(count_sex_2),
         count_game_1 = as.numeric(count_game_1),
         count_game_2 = as.numeric(count_game_2)) %>%
  mutate(f_athletes_p = count_sex_1 / sum(count_sex_1, count_sex_2),
         f_games_p = count_game_1 / sum(count_game_1, count_game_2))
participate_sex %>% 
  ggplot(aes(x = year, y = f_athletes_p)) +
  geom_line(color = "orange") +
  geom_line(aes(x = year, y = f_games_p), color = "steelblue") + 
  facet_wrap(vars(season), scales = "free") +
  labs(title = "Female athletes participation in Olympic Games by season",
       subtitle = "From year 1900 to 2016",
       x = "Year",
       y = "Proportion") +
  theme_minimal()
```

```{r Q2-2-country ranking}

```

### Discussion

Discussion (1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.


We encourage you to be concise. A paragraph should typically not be longer than 5 sentences. You are not required to perform any statistical tests in this project, but you may do so if you find it helpful to answer your question.





